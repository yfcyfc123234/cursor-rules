---
alwaysApply: true
---

# 项目规则自动管理

## 规则文件夹配置

- **规则文件夹路径**：`C:\Users\Administrator\Desktop\cursor-rules`
- **规则文件格式**：`.mdc` 格式，必须包含 frontmatter 元数据
- **规则文件命名规范**：
  - Android 项目：`android-project.mdc`
  - Flutter 项目：`flutter-project.mdc`
  - Android+Flutter 混合项目：`android-flutter-project.mdc`
  - Python 项目：`python-project.mdc`
  - PHP 项目：`php-project.mdc`
  - Kotlin 项目：`kotlin-project.mdc`
  - Java 项目：`java-project.mdc`

## 项目规则文件位置

- **项目规则目录**：`.cursor/rules/`
- **文件命名**：使用描述性名称（如 `android-rules.mdc`）
- **文件格式**：必须包含 frontmatter 元数据，标准格式如下：
  
  ---
  alwaysApply: true
  ---
  
  规则内容...
  
## 项目类型检测逻辑

当项目根目录的 `.cursor/rules/` 目录不存在或为空时，按以下优先级自动检测项目类型：

1. **Flutter 混合项目**：
   - 检测条件：存在 `pubspec.yaml` 且存在 `android/` 目录
   - 查找规则：`android-flutter-project.mdc`

2. **Flutter 项目**：
   - 检测条件：存在 `pubspec.yaml`
   - 查找规则：`flutter-project.mdc`

3. **Android 项目**：
   - 检测条件：存在 `settings.gradle` 或根目录 `build.gradle`，且不存在 `pubspec.yaml`
   - 查找规则：`android-project.mdc`

4. **Python 项目**：
   - 检测条件：存在 `requirements.txt` 或 `pyproject.toml`
   - 查找规则：`python-project.mdc`

5. **PHP 项目**：
   - 检测条件：存在 `composer.json`
   - 查找规则：`php-project.mdc`

6. **其他类型**：
   - 根据主要代码文件类型判断
   - `.kt` 文件为主 → `kotlin-project.mdc`
   - `.java` 文件为主 → `java-project.mdc`

## 自动管理流程

### 场景 1：找到匹配的规则文件

当在规则文件夹中找到对应项目类型的规则文件时：
1. 读取规则文件内容（包含完整的 frontmatter）
2. 在项目根目录创建 `.cursor/rules/` 目录（如果不存在）
3. 检查目录中已存在的 `.mdc` 文件，使用下一个可用名称
   - 如果已有 `android-rules.mdc`，则使用 `android-rules2.mdc`
   - 如果已有 `android-rules.mdc` 和 `android-rules2.mdc`，则使用 `android-rules3.mdc`
   - 依此类推
4. 复制规则文件到项目 `.cursor/rules/{名称}.mdc`
5. 提示用户："✅ 已从规则文件夹导入 [项目类型] 项目规则到 `.cursor/rules/{名称}.mdc`"

### 场景 2：未找到匹配的规则文件

当在规则文件夹中未找到对应项目类型的规则文件时：
1. 根据项目类型创建新的规则模板
   - 包含完整的 frontmatter（`---\nalwaysApply: true\n---`）
   - 包含项目特定的代码风格、架构模式、依赖管理等规范
   - 参考已创建的示例规则文件格式
2. 保存新规则到规则文件夹（使用对应的文件名，如 `android-project.mdc`）
3. 在项目根目录创建 `.cursor/rules/` 目录（如果不存在）
4. 检查目录中已存在的 `.mdc` 文件，使用下一个可用名称
5. 同时复制到当前项目 `.cursor/rules/{名称}.mdc`
6. 提示用户："✅ 已创建新的 [项目类型] 项目规则模板，保存到规则文件夹并导入到 `.cursor/rules/{名称}.mdc`"

### 场景 3：项目已有规则文件

当 `.cursor/rules/` 目录已存在且不为空时：
- 不覆盖现有规则文件
- 提示用户："ℹ️ 项目已有规则文件，跳过自动导入。如需更新，请手动操作。"

## 执行时机

- **首次打开项目时**：自动检查 `.cursor/rules/` 目录，如果不存在或为空则执行自动管理流程
- **用户主动请求时**：用户明确要求"生成项目规则"、"导入项目规则"或"创建项目规则"时执行
- **项目类型变更时**：当检测到项目类型发生变化时（如从纯 Android 变为混合项目），可以提示用户是否需要更新规则

## 规则模板内容建议

根据项目类型创建规则模板时，应该包含以下内容：
- **项目类型说明**：明确项目类型和主要技术栈
- **代码风格规范**：命名规范、代码格式、注释规范等
- **架构模式**：推荐的架构模式和代码组织方式
- **依赖管理**：依赖管理工具和常用库
- **错误处理**：异常处理和日志记录规范
- **Git 工作流**：Git 相关的规范和自动操作
- **其他项目特定规范**：如性能优化、安全要求、国际化等

## 注意事项

- 规则文件夹如果不存在，先自动创建目录
- 所有规则文件必须包含 frontmatter 元数据，否则可能无法正确加载
